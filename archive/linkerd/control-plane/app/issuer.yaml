apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: linkerd-issuer-approle
  namespace: linkerd
spec:
  refreshInterval: "15s"
  secretStoreRef:
    name: cluster-secrets
    kind: ClusterSecretStore
  target:
    name: linkerd-issuer-approle
  data:
    - secretKey: secretId
      remoteRef:
        key: linkerd-issuer-approle
        property: secretId
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: linkerd-ca-issuer
  namespace: linkerd
spec:
  vault:
    path: pki/issuer/Linkerd-mTLS-RootCA/sign-intermediate
    server: https://vault-active.vault.svc.cluster.local:8200
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURRekNDQWl1Z0F3SUJBZ0lVT2FlRmJTZVg1cDcxM1ZKcExwTE5VZEJwb3lBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tURW5NQ1VHQTFVRUF4TWVRVXREYUhKcGMzUnBZVzV6Wlc0Z1RtVjBkMjl5YXlCU2IyOTBJRU5CTUI0WApEVEl6TURneU1qSXlORE14TTFvWERUTXpNRGd4T1RJeU5ETTBNbG93S1RFbk1DVUdBMVVFQXhNZVFVdERhSEpwCmMzUnBZVzV6Wlc0Z1RtVjBkMjl5YXlCU2IyOTBJRU5CTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEEKTUlJQkNnS0NBUUVBbzJPQnRDS3dHMzdYOTdjZURUSU5LcEZ4dUtXMFhuTXVRczNVVDNZdDZEYVpic3MrVkxqOQpDYW1ueXNFVHJKWFVBZEdSMmdJTE1IMlJ5c085TTVPQWNZSEVVZE5UVmRtWFdlS2Z0ZjNSQjdvSXVLTll0aGcrCnlmZ3ZjUVVpQWh4RHV6T2hPUlpqVkpjT2E3MUZYditDdDk2QVFGV3UzeGRmdiswM2ZYbU0rV2dNOU5FRURwaysKdkZGdGp6NW96aG5WSEJzdkRrbStsc0E2UDdkWUduckhUTEVLd0xvV09WVHJwZUhzZXJlL2NMSlppRFFWNjRTaAo2U3hUQVg5T0FxQ0JqTU13VktFdjU5ZlhYSDhQNmZIN0l6TXcvOVZWRC9qdWJBZFJHZ3U0Q3VURThmMHhGVmgzCmhxOFliM1lJZFhxcnpScnNGRjZydWM0ZXNVakFsYTdhVVFJREFRQUJvMk13WVRBT0JnTlZIUThCQWY4RUJBTUMKQVFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXpnK1FVR1RnSUJtcjROWForUzVMMTkxNwozU3N3SHdZRFZSMGpCQmd3Rm9BVXpnK1FVR1RnSUJtcjROWForUzVMMTkxNzNTc3dEUVlKS29aSWh2Y05BUUVMCkJRQURnZ0VCQURUbnlzaFZxbWJhUFFQcVBBSEZxWDhSLzcvTFJ0d3l0NmZnOEJ0NHNDNytTNFZiL3V1MjFiWjEKWnU0TkFVTk85QXBHNU8yQi9ZZVphUndzVU9UeFA5Vm9rTitIWVFiVGlwV3JrUUpQRXV1SlRVdklLYkZXazlvSApBY2NBb05ucHBTR0kvTVFIYktKUTBYZFZsNmdxcHdaVXRYRjJJdys5ek9ZNllGMi9sdGhNMG9DNEJrRFpMN0NoCkVLVy9ybmIrYVdjd0VrQkt2K2txR1hzRm9KN05NaUY2OFBOTmVic2VtNmRONW1QUHpWSElWVFNBeDJEMzhRbVcKcTM0aTlaUHNmZ1V4RENJQWE3TTZFUDNYMW02QWpocU9vbEpQTTkwbzNwQ1ducVQzbkFaOUg3OVd1Tlg0SjBNSApqZTdiYkZGbDhPSk1QVnVjRU9Fdklna0swTUJsbnlZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlENFRDQ0FzbWdBd0lCQWdJVWI4WWFIampqcDZaUWFoeFNKd0tJaTZVSFd5TXdEUVlKS29aSWh2Y05BUUVMCkJRQXdLVEVuTUNVR0ExVUVBeE1lUVV0RGFISnBjM1JwWVc1elpXNGdUbVYwZDI5eWF5QlNiMjkwSUVOQk1CNFgKRFRJek1EZ3lNekEwTURReU1Gb1hEVEk0TURneU1UQTBNRFExTUZvd01URXZNQzBHQTFVRUF4TW1RVXREYUhKcApjM1JwWVc1elpXNGdUbVYwZDI5eWF5QkpiblJsY20xbFpHbGhkR1VnUTBFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCCkFRVUFBNElCRHdBd2dnRUtBb0lCQVFERDMxZGJrL1UraXJiclR4SGxQR2Z2K2VjWXBjK0hWUjNKSEdTU2JyaloKMlZ0OG9wckdBS2lNcFJGdk5jYSt1ZmFubys5TFhYVGs5TG85SFJHbjRPZUh6RHNrOFJ3QUtnSVV6TC9lNzQxYgo1T3E1cWZWS0Rsc2diY1Q1aWRWVVJhL1liMVMwY3JucEZ5TFRHbzZpWDliWEV4TE02YTBIS2kwbGNjaUdya2lqCmFrRDlvbEE4NjJSdUJ4dWplWE1aK1UxU2g5SmZVYnFBNTdFOElBaWtRdkZwd2xlYkU2cEFUOEEyRU1RZ3AxaSsKM3dKanhKTnY5ckMrMWdBTEJUNTgwb25YYVdoZzJHdWRSTHk1bmxKR2l4c0wrMkZkUlZQWWhOTHRqR09RSzRBYgpCcHJMVzFLWmp0ME9ta25MdmsvbFFIT1JhUFkwV2pPelBZU1R4R2hJTWdnMUFnTUJBQUdqZ2Znd2dmVXdEZ1lEClZSMFBBUUgvQkFRREFnRUdNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGS0FHS3J5K3hKSHAKU3VSYUdPbjd5aU1Nc3RMQU1COEdBMVVkSXdRWU1CYUFGTTRQa0ZCazRDQVpxK0RWMmZrdVM5ZmRlOTByTUUwRwpDQ3NHQVFVRkJ3RUJCRUV3UHpBOUJnZ3JCZ0VGQlFjd0FvWXhhSFIwY0RvdkwzQnBMWFpoZFd4MExtRnJZMmh5CmFYTjBhV0Z1YzJWdUxtTnZiVG80TWpBd0wzWXhMM0JyYVM5allUQkRCZ05WSFI4RVBEQTZNRGlnTnFBMGhqSm8KZEhSd09pOHZjR2t0ZG1GMWJIUXVZV3RqYUhKcGMzUnBZVzV6Wlc0dVkyOXRPamd5TURBdmRqRXZjR3RwTDJOeQpiREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBRm11R1E3Q2VKRjVQT29PQmlpdC9uZmJEbHV3ZG1ldlNyKzBKClZtanNjQmIwUGh1UEk0Ujg1dlRqNEZJVThxSDl1K0RKSmpyQ0ttZVRCMUNZL2J3YXNkbTVablZMTDR3Z2ZxVDYKdTJ4SHNOa2hic01tWmp1YklzMzRJTEdYRURobndRQXNkTDkySmsrTEF2bjFXbitVWkhaeUlXTTFxTFhHY1NkeQpadkhLdnR1SjZxTXl2c1B3L0ZLU013N0RLUk93ZTRsSC9OcldZVUVVdWM0UFZQY3hHSjg3VUJ5My91STFOTnJ2Cm9EeWsydERLNEF6Yy9UOEJUdVBBa3BWdHdwTEZYeUpzVWlRRU1nZnJHT1VtZDhIbG53bVErNUcwcUxLU2xEVG8KeWxjMWlheXpYRlJzeWpRU0NCOFg2T0VTS25sb0FwbUN6a0xRMFdtZjd4elZlNG9aSUE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
    auth:
      appRole:
        path: approle
        roleId: "5dddf291-dd4b-916a-d095-065d94664774"
        secretRef:
          name: linkerd-issuer-approle
          key: secretId
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: linkerd-issuer
  namespace: linkerd
spec:
  vault:
    path: pki/sign/linkerd-role
    server: https://vault-active.vault.svc.cluster.local:8200
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURRekNDQWl1Z0F3SUJBZ0lVT2FlRmJTZVg1cDcxM1ZKcExwTE5VZEJwb3lBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tURW5NQ1VHQTFVRUF4TWVRVXREYUhKcGMzUnBZVzV6Wlc0Z1RtVjBkMjl5YXlCU2IyOTBJRU5CTUI0WApEVEl6TURneU1qSXlORE14TTFvWERUTXpNRGd4T1RJeU5ETTBNbG93S1RFbk1DVUdBMVVFQXhNZVFVdERhSEpwCmMzUnBZVzV6Wlc0Z1RtVjBkMjl5YXlCU2IyOTBJRU5CTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEEKTUlJQkNnS0NBUUVBbzJPQnRDS3dHMzdYOTdjZURUSU5LcEZ4dUtXMFhuTXVRczNVVDNZdDZEYVpic3MrVkxqOQpDYW1ueXNFVHJKWFVBZEdSMmdJTE1IMlJ5c085TTVPQWNZSEVVZE5UVmRtWFdlS2Z0ZjNSQjdvSXVLTll0aGcrCnlmZ3ZjUVVpQWh4RHV6T2hPUlpqVkpjT2E3MUZYditDdDk2QVFGV3UzeGRmdiswM2ZYbU0rV2dNOU5FRURwaysKdkZGdGp6NW96aG5WSEJzdkRrbStsc0E2UDdkWUduckhUTEVLd0xvV09WVHJwZUhzZXJlL2NMSlppRFFWNjRTaAo2U3hUQVg5T0FxQ0JqTU13VktFdjU5ZlhYSDhQNmZIN0l6TXcvOVZWRC9qdWJBZFJHZ3U0Q3VURThmMHhGVmgzCmhxOFliM1lJZFhxcnpScnNGRjZydWM0ZXNVakFsYTdhVVFJREFRQUJvMk13WVRBT0JnTlZIUThCQWY4RUJBTUMKQVFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXpnK1FVR1RnSUJtcjROWForUzVMMTkxNwozU3N3SHdZRFZSMGpCQmd3Rm9BVXpnK1FVR1RnSUJtcjROWForUzVMMTkxNzNTc3dEUVlKS29aSWh2Y05BUUVMCkJRQURnZ0VCQURUbnlzaFZxbWJhUFFQcVBBSEZxWDhSLzcvTFJ0d3l0NmZnOEJ0NHNDNytTNFZiL3V1MjFiWjEKWnU0TkFVTk85QXBHNU8yQi9ZZVphUndzVU9UeFA5Vm9rTitIWVFiVGlwV3JrUUpQRXV1SlRVdklLYkZXazlvSApBY2NBb05ucHBTR0kvTVFIYktKUTBYZFZsNmdxcHdaVXRYRjJJdys5ek9ZNllGMi9sdGhNMG9DNEJrRFpMN0NoCkVLVy9ybmIrYVdjd0VrQkt2K2txR1hzRm9KN05NaUY2OFBOTmVic2VtNmRONW1QUHpWSElWVFNBeDJEMzhRbVcKcTM0aTlaUHNmZ1V4RENJQWE3TTZFUDNYMW02QWpocU9vbEpQTTkwbzNwQ1ducVQzbkFaOUg3OVd1Tlg0SjBNSApqZTdiYkZGbDhPSk1QVnVjRU9Fdklna0swTUJsbnlZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlENFRDQ0FzbWdBd0lCQWdJVWI4WWFIampqcDZaUWFoeFNKd0tJaTZVSFd5TXdEUVlKS29aSWh2Y05BUUVMCkJRQXdLVEVuTUNVR0ExVUVBeE1lUVV0RGFISnBjM1JwWVc1elpXNGdUbVYwZDI5eWF5QlNiMjkwSUVOQk1CNFgKRFRJek1EZ3lNekEwTURReU1Gb1hEVEk0TURneU1UQTBNRFExTUZvd01URXZNQzBHQTFVRUF4TW1RVXREYUhKcApjM1JwWVc1elpXNGdUbVYwZDI5eWF5QkpiblJsY20xbFpHbGhkR1VnUTBFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCCkFRVUFBNElCRHdBd2dnRUtBb0lCQVFERDMxZGJrL1UraXJiclR4SGxQR2Z2K2VjWXBjK0hWUjNKSEdTU2JyaloKMlZ0OG9wckdBS2lNcFJGdk5jYSt1ZmFubys5TFhYVGs5TG85SFJHbjRPZUh6RHNrOFJ3QUtnSVV6TC9lNzQxYgo1T3E1cWZWS0Rsc2diY1Q1aWRWVVJhL1liMVMwY3JucEZ5TFRHbzZpWDliWEV4TE02YTBIS2kwbGNjaUdya2lqCmFrRDlvbEE4NjJSdUJ4dWplWE1aK1UxU2g5SmZVYnFBNTdFOElBaWtRdkZwd2xlYkU2cEFUOEEyRU1RZ3AxaSsKM3dKanhKTnY5ckMrMWdBTEJUNTgwb25YYVdoZzJHdWRSTHk1bmxKR2l4c0wrMkZkUlZQWWhOTHRqR09RSzRBYgpCcHJMVzFLWmp0ME9ta25MdmsvbFFIT1JhUFkwV2pPelBZU1R4R2hJTWdnMUFnTUJBQUdqZ2Znd2dmVXdEZ1lEClZSMFBBUUgvQkFRREFnRUdNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGS0FHS3J5K3hKSHAKU3VSYUdPbjd5aU1Nc3RMQU1COEdBMVVkSXdRWU1CYUFGTTRQa0ZCazRDQVpxK0RWMmZrdVM5ZmRlOTByTUUwRwpDQ3NHQVFVRkJ3RUJCRUV3UHpBOUJnZ3JCZ0VGQlFjd0FvWXhhSFIwY0RvdkwzQnBMWFpoZFd4MExtRnJZMmh5CmFYTjBhV0Z1YzJWdUxtTnZiVG80TWpBd0wzWXhMM0JyYVM5allUQkRCZ05WSFI4RVBEQTZNRGlnTnFBMGhqSm8KZEhSd09pOHZjR2t0ZG1GMWJIUXVZV3RqYUhKcGMzUnBZVzV6Wlc0dVkyOXRPamd5TURBdmRqRXZjR3RwTDJOeQpiREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBRm11R1E3Q2VKRjVQT29PQmlpdC9uZmJEbHV3ZG1ldlNyKzBKClZtanNjQmIwUGh1UEk0Ujg1dlRqNEZJVThxSDl1K0RKSmpyQ0ttZVRCMUNZL2J3YXNkbTVablZMTDR3Z2ZxVDYKdTJ4SHNOa2hic01tWmp1YklzMzRJTEdYRURobndRQXNkTDkySmsrTEF2bjFXbitVWkhaeUlXTTFxTFhHY1NkeQpadkhLdnR1SjZxTXl2c1B3L0ZLU013N0RLUk93ZTRsSC9OcldZVUVVdWM0UFZQY3hHSjg3VUJ5My91STFOTnJ2Cm9EeWsydERLNEF6Yy9UOEJUdVBBa3BWdHdwTEZYeUpzVWlRRU1nZnJHT1VtZDhIbG53bVErNUcwcUxLU2xEVG8KeWxjMWlheXpYRlJzeWpRU0NCOFg2T0VTS25sb0FwbUN6a0xRMFdtZjd4elZlNG9aSUE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
    auth:
      appRole:
        path: approle
        roleId: "5dddf291-dd4b-916a-d095-065d94664774"
        secretRef:
          name: linkerd-issuer-approle
          key: secretId
