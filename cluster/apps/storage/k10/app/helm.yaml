---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: k10
  namespace: kasten-io
spec:
  interval: 5m
  chart:
    spec:
      chart: k10
      version: 6.5.0
      sourceRef:
        kind: HelmRepository
        name: kasten-io
        namespace: flux-system
      interval: 5m
  install:
    createNamespace: true
  values:
    networkPolicy:
      create: true
    global:
      persistence:
        mountPath: "/mnt/k10state"
        enabled: true
        storageClass: "nfs-csi"
        accessMode: ReadWriteOnce
        size: 20Gi
    eula:
      accept: true
      company: "No Company"
      email: "gage@gageserver.com"
    cacertconfigmap:
      name: "custom-ca-bundle-store"
    encryption:
      primaryKey:
        vaultTransitKeyName: "k10-transit-key"
        vaultTransitPath: "k10-transit"
    vault:
      role: "k10-transit"
      address: "https://vault-active.vault.svc.cluster.local:8200"
    prometheus:
      server:
        enabled: false
    grafana:
      enabled: false
    auth:
      oidcAuth:
        enabled: true
        prompt: "login" #The prompt type to be requested with the OIDC provider. Default is select_account.
        usernameClaim: "email" #Claim to be used as the username
        groupClaim: "groups" #Name of a custom OpenID Connect claim for specifying user groups
        secretName: "oidc-secret"
        sessionDuration: "1h" #Maximum OIDC session duration. Default value is 1 hour
        refreshTokenSupport: false #Enable Refresh Token support. Disabled by default
